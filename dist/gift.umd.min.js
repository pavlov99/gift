!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.gift={})}(this,function(t){"use strict";var e=/([+-]?\d+(\.\d+)?)([eE][+-]?\d+)?/,r=new RegExp(e.source+"((:"+e.source+")|(\\.\\."+e.source+"))?"),n=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),i=function(t){var e=t.prefix,r=t.credit,i=t.value,o=t.feedback;if(void 0===i)throw new Error("Invalid value '"+i+"', should not be empty");if(this.value=i,void 0!==e&&"="!==e&&"~"!==e)throw new Error("Invalid prefix value: "+e+". Use [undefined, '~', '=']");if(this.prefix=e,void 0!==r){if(this.credit=parseFloat(r),!this.credit)throw new Error("Invalid credit value '"+r+"'. Should be a number.");if(this.credit>1||this.credit<-1)throw new n("Invalid credit value '"+this.credit+"'. Should be in [-1, 1].")}else this.credit=void 0;this.feedback=o};i.prototype.toString=function(){var t=this.prefix?this.prefix:"",e=this.credit?"%"+100*this.credit+"%":"",r=this.feedback?"#"+this.feedback:"";return""+t+e+this.value+r},i.fromString=function(t){var e=t.match(/^([=~])?(%-?\d{1,3}%)?([^=~#]*)(#[^=~]*)?$/);if(e){var r=e[2]?parseFloat(e[2].slice(1,-1))/100:void 0,o=e[4]?e[4].slice(1):void 0;try{return new i({prefix:e[1],credit:r,value:e[3],feedback:o})}catch(t){if(t instanceof n)return new i({prefix:e[1],value:e[2]+e[3],feedback:o})}}};var o=function(t){var e=t.type,r=t.options;void 0===r&&(r=[]),this.type=e,this.options=r};o.splitOptions=function(t){return t.trim().split(/([=~](?:(?:\\[=~#{}])|(?:[^=~]))+)/g).filter(function(t){return t}).map(function(t){return t.trim()})},o.fromString=function(t){if("{"!=t.charAt(0)||"}"!=t.charAt(t.length-1))throw new Error("Block should start with '{' and end with '}': "+t);var e=t.slice(1,-1),n=new RegExp("[=~](%\\d{2}%)?"+r.source+"\\s*(#[^=~]*)?"),u=new RegExp("^(("+r.source+")|((\\s*"+n.source+")+))$");if(/^[\s]*$/.test(e))return new o({type:o.TYPES.TEXT,options:[]});if(/^(TRUE|FALSE|T|F)$/.test(e))return new o({type:o.TYPES.BOOLEAN,options:[new i({value:/^(TRUE|T)$/.test(e)})]});if("#"==e.charAt(0)){if(u.test(e.slice(1)))return new o({type:o.TYPES.NUMBER,options:[i.fromString(e.slice(1))]});throw new Error("Invalid number block: "+t)}var s=this.splitOptions(e).map(function(t){return i.fromString(t)});return s.every(function(t){return"~"==t.prefix})?new o({type:o.TYPES.CHECKBOX,options:s}):s.every(function(t){return"="==t.prefix})?s.every(function(t){return t.value.includes("->")})?new o({type:o.TYPES.MATCHING,options:s}):new o({type:o.TYPES.INPUT,options:s}):s.every(function(t){return"~"==t.prefix||"="==t.prefix})?new o({type:o.TYPES.RADIO,options:s}):void 0},o.fromMaskedString=function(t){if("{"!=t.charAt(0)||"}"!=t.charAt(t.length-1))throw new Error("Block should start with '{' and end with '}': "+t);var e=t.slice(1,-1);if(""===e)return new o({type:o.TYPES.TEXT});if("~"===e)return new o({type:o.TYPES.BOOLEAN});if("#"===e)return new o({type:o.TYPES.NUMBER});if("="===e)return new o({type:o.TYPES.INPUT});var r=this.splitOptions(e).map(function(t){return i.fromString(t)});if(r.every(function(t){return"~"==t.prefix}))return new o({type:o.TYPES.CHECKBOX,options:r});if(r.every(function(t){return"="==t.prefix}))return new o({type:o.TYPES.RADIO,options:r});throw Error("Could not parse masked block options")},o.getType=function(t){var e=this.fromString(t);if(e)return e.type},o.isValid=function(t){return"{"==t.charAt(0)&&"}"==t.charAt(t.length-1)},o.prototype.toString=function(){},o.prototype.toMaskedString=function(){switch(this.type){case o.TYPES.TEXT:return"{}";case o.TYPES.BOOLEAN:return"{~}";case o.TYPES.NUMBER:return"{#}";case o.TYPES.INPUT:return"{=}";case o.TYPES.RADIO:return"{"+this.options.map(function(t){return"="+t.value}).join(" ")+"}";case o.TYPES.CHECKBOX:return"{"+this.options.map(function(t){return"~"+t.value}).join(" ")+"}";default:throw Error("Could not mask block. Unsupported type "+this.type)}},o.prototype.grade=function(t){},o.TYPES=Object.freeze({BOOLEAN:"BOOLEAN",NUMBER:"NUMBER",MATCHING:"MATCHING",INPUT:"INPUT",RADIO:"RADIO",CHECKBOX:"CHECKBOX",TEXT:"TEXT"});var u=function(){};u.splitBlocks=function(t){return t.split(/({[^}]*})/g).filter(function(t){return t})},t.Block=o,t.Question=u,Object.defineProperty(t,"__esModule",{value:!0})});
