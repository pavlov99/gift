!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.gift={})}(this,function(t){"use strict";var e=/([+-]?\d+(\.\d+)?)([eE][+-]?\d+)?/,r=new RegExp(e.source+"((:"+e.source+")|(\\.\\."+e.source+"))?"),n=function(t){var e=t.prefix,r=t.credit,n=t.value,i=t.feedback;if(void 0===n)throw new Error("Invalid value '"+n+"', should not be empty");if(this.value=n,void 0!==e&&"="!=e&&"~"!=e)throw new Error("Invalid prefix value: "+e+". Use [undefined, '~', '=']");if(this.prefix=e,void 0!==r){if(isNaN(parseFloat(r)))throw new Error("Invalid credit value '"+r+"'. Should be a number.");if(this.credit=parseFloat(r),this.credit>1||this.credit<-1)throw new Error("Invalid credit value '"+this.credit+"'. Should be in [-1, 1].")}else this.credit=void 0;this.feedback=i};n.prototype.toString=function(){var t=this.prefix?this.prefix:"",e=this.credit?"%"+100*this.credit+"%":"",r=this.feedback?"#"+this.feedback:"";return""+t+e+this.value+r},n.fromString=function(t){var e=t.match(/^([=~])?(%-?\d{1,3}%)?([^=~#]*)(#[^=~]*)?$/);if(e){var r=e[2]?parseFloat(e[2].slice(1,-1))/100:void 0,i=e[4]?e[4].slice(1):void 0;return new n({prefix:e[1],credit:r,value:e[3],feedback:i})}};var i=function(t){var e=t.type,r=t.options;void 0===r&&(r=[]),this.type=e,this.options=r};i.splitOptions=function(t){return t.trim().split(/([=~](?:(?:\\[=~#{}])|(?:[^=~]))+)/g).filter(function(t){return t}).map(function(t){return t.trim()})},i.fromString=function(t){if("{"!=t.charAt(0)||"}"!=t.charAt(t.length-1))throw new Error("Block should start with '{' and end with '}': "+t);var e=t.slice(1,-1),o=new RegExp("[=~](%\\d{2}%)?"+r.source+"\\s*(#[^=~]*)?"),u=new RegExp("^(("+r.source+")|((\\s*"+o.source+")+))$");if(/^[\s]*$/.test(e))return new i({type:i.TYPES.TEXT,options:[]});if(/^(TRUE|FALSE|T|F)$/.test(e))return new i({type:i.TYPES.BOOLEAN,options:[new n({value:/^(TRUE|T)$/.test(e)})]});if("#"==e.charAt(0)){if(u.test(e.slice(1)))return new i({type:i.TYPES.NUMBER,options:[n.fromString(e.slice(1))]});throw new Error("Invalid number block: "+t)}var s=this.splitOptions(e).map(function(t){return n.fromString(t)});return s.every(function(t){return"~"==t.prefix})?new i({type:i.TYPES.CHECKBOX,options:s}):s.every(function(t){return"="==t.prefix})?s.every(function(t){return t.value.includes("->")})?new i({type:i.TYPES.MATCHING,options:s}):new i({type:i.TYPES.INPUT,options:s}):s.every(function(t){return"~"==t.prefix||"="==t.prefix})?new i({type:i.TYPES.RADIO,options:s}):void 0},i.fromMaskedString=function(t){if("{"!=t.charAt(0)||"}"!=t.charAt(t.length-1))throw new Error("Block should start with '{' and end with '}': "+t);var e=t.slice(1,-1);if(""===e)return new i({type:i.TYPES.TEXT});if("~"===e)return new i({type:i.TYPES.BOOLEAN});if("#"===e)return new i({type:i.TYPES.NUMBER});if("="===e)return new i({type:i.TYPES.INPUT});var r=this.splitOptions(e).map(function(t){return n.fromString(t)});if(r.every(function(t){return"~"==t.prefix}))return new i({type:i.TYPES.CHECKBOX,options:r});if(r.every(function(t){return"="==t.prefix}))return new i({type:i.TYPES.RADIO,options:r});throw Error("Could not parse masked block options")},i.getType=function(t){var e=this.fromString(t);if(e)return e.type},i.isValid=function(t){return"{"==t.charAt(0)&&"}"==t.charAt(t.length-1)},i.prototype.toString=function(){},i.prototype.toMaskedString=function(){switch(this.type){case i.TYPES.TEXT:return"{}";case i.TYPES.BOOLEAN:return"{~}";case i.TYPES.NUMBER:return"{#}";case i.TYPES.INPUT:return"{=}";case i.TYPES.RADIO:return"{"+this.options.map(function(t){return"="+t.value}).join(" ")+"}";case i.TYPES.CHECKBOX:return"{"+this.options.map(function(t){return"~"+t.value}).join(" ")+"}";default:throw Error("Could not mask block. Unsupported type "+this.type)}},i.prototype.grade=function(t){},i.TYPES=Object.freeze({BOOLEAN:"BOOLEAN",NUMBER:"NUMBER",MATCHING:"MATCHING",INPUT:"INPUT",RADIO:"RADIO",CHECKBOX:"CHECKBOX",TEXT:"TEXT"});var o=function(){};o.splitBlocks=function(t){return t.split(/({[^}]*})/g).filter(function(t){return t})},t.Block=i,t.Question=o,Object.defineProperty(t,"__esModule",{value:!0})});
